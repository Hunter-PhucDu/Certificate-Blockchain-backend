1. Tổng Quan
Hệ thống quản lý văn bằng chứng chỉ cho phép nhiều tổ chức khác nhau tự quản lý và phát hành các chứng chỉ. Mỗi tổ chức được cấp một subdomain riêng để truy cập hệ thống, đảm bảo tính riêng tư và phân tách dữ liệu giữa các tổ chức. Dữ liệu sẽ được lưu trữ trong một cơ sở dữ liệu MongoDB duy nhất, với cấu trúc cho phép phân chia dữ liệu theo tenant (tổ chức).

2. Cấu Trúc Hệ Thống
2.1 Các Thành Phần Chính
Backend : Được xây dựng bằng NestJS và MongoDB, Blockchain với các Module khác nhau, mỗi module bao gồm: dtos (requestDto, responseDto), controllers, services và module để xử lý logic và các nghiệp vụ liên quan
Cơ sở Dữ liệu : Blockchain sẽ lưu thông tin của chứng chỉ, MongoDB sẽ lưu trữ tất cả thông tin liên quan đến tổ chức, người dùng và chứng chỉ ( lưu: blockId, transactionHash, organizationId, issuedDate, customData, customDataMap,....).
2.2 Các Schema Cơ Bản
Organization : Lưu trữ thông tin của tổ chức, bao gồm tên, subdomain và các trường tùy chỉnh.
User : Quản lý thông tin người dùng, bao gồm tên đăng nhập, mật khẩu và vai trò (SuperAdmin, Admin, hoặc Organization).
Certificate : Lưu trữ thông tin chứng chỉ được phát hành, liên kết với organizationId. Trường này giúp tổ chức quản lý trên fontend như thêm sửa xóa chứng chỉ hoặc tìm kiếm.
OPT: lưu trữ thông tin OTP để xác thực các yêu cầu như xác nhận email, lấy lại mật khẩu,....
3. Mô Hình Đa Tenant
3.1 Cách Thức Quản Lý Tenant
Sử Dụng organizationId : Mỗi document trong collection users và certificates sẽ có trường organizationId để chỉ định tổ chức cụ thể mà document đó thuộc về.
Phân Quyền Truy Cập : Hệ thống sẽ kiểm tra organizationId để đảm bảo người dùng chỉ có thể truy cập dữ liệu của tổ chức của họ.
3.2 Sử Dụng Subdomain
Mỗi tổ chức sẽ được cấp một subdomain duy nhất (ví dụ: tochuca.abc.com).
Subdomain sẽ được sử dụng để xác định tổ chức trong các yêu cầu đến server.
Middleware sẽ được cài đặt trong NestJS để lấy thông tin subdomain từ yêu cầu và lưu trữ nó vào req trước khi chuyển tiếp đến các route handler.

4. Quy Trình Hoạt Động
4.1 Đăng Ký Tổ Chức
SuperAdmin mới có quyền đăng ký thêm mới tổ chức organization vào hệ thống ( tên tổ chức, email,subdomain, ....).
Tổ chức sẽ tự động nhận thông báo xác nhận qua email, kèm theo chi tiết subdomain.
4.2 Đăng Nhập Người Dùng
Người dùng nhập thông tin tài khoản qua trang đăng nhập.
Hệ thống xác thực thông tin và xác định tổ chức thông qua subdomain (nếu có), hoặc email xác nhận.
Nếu xác thực thành công, hệ thống sẽ tạo session hoặc token cho người dùng để thực hiện các yêu cầu tiếp theo.
4.3 Quản Lý Chứng Chỉ
Tổ chức có thể tạo, sửa, hoặc xóa chứng chỉ, theo quy trình lưu lên blockchain thành công mới quay về lưu vào mongodb.
Khi một chứng chỉ mới được tạo ra, thông tin sẽ được lưu trên blockchain trước và quay về lưu vào collection certificates với organizationId, blockId, hash,... tương ứng.
Các trường tùy chỉnh có thể được định nghĩa riêng cho mỗi chứng chỉ.
5. Yếu Tố Cần Thêm Vào
5.1 Bảo Mật
Hashed Password : Sử dụng bcrypt hoặc bất kỳ phương thức mã hóa nào khác để bảo mật mật khẩu người dùng.
Xác thực JWT : Sử dụng JSON Web Tokens cho xác thực và phân quyền.
Middleware bảo mật : Xác thực quyền truy cập vào các route dựa trên vai trò của người dùng.
5.2 Tính Năng Quản Lý
Quản lý Tùy Chỉnh Trường Dữ Liệu : Cho phép các tổ chức có thể thêm các trường tùy chỉnh riêng.
5.3 Cấu Hình DNS
Cần cấu hình DNS với tính năng wildcard để cho phép truy cập subdomain (ví dụ: *.abc.com).
Điều này sẽ giúp đảm bảo rằng tất cả các subdomain đều được chuyển tiếp về server thích hợp.